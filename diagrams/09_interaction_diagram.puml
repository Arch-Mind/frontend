@startuml ArchMind_Interaction_Diagram

skinparam dpi 100
skinparam activityFontSize 11
skinparam arrowFontSize 9
skinparam noteFontSize 9
skinparam activityBackgroundColor #E8EAF6
skinparam activityBorderColor #3F51B5
skinparam activityDiamondBackgroundColor #FFF9C4
skinparam activityDiamondBorderColor #F9A825

title ArchMind - Interaction Overview Diagram\nEnd-to-End Analysis and Visualization Flow

start

:== ref: Activation Sequence ==
Developer opens VS Code
Extension activates and registers commands
Health check: GET /api/v1/health
Status bar shows ArchMind Connected;

if (Analysis Trigger?) then (Manual)

  :== ref: Manual Analysis ==
  Developer runs Analyze Repository
  Extension prompts for GitHub URL
  POST /api/v1/analyze with repo_url
  API Gateway validates and creates job
  Returns job_id to Extension;

else (Webhook)

  :== ref: Webhook Trigger ==
  GitHub sends POST /api/v1/webhook
  API Gateway verifies HMAC signature
  Parses push event payload
  Creates analysis job in PostgreSQL
  Pushes job to Redis queue;

endif

:== ref: Job Queuing ==
API Gateway pushes job to Redis LPUSH
Job status set to queued in PostgreSQL
Extension receives job_id 202 Accepted;

#FFF3E0:== ref: Ingestion Processing ==
Worker polls Redis BRPOP job_queue
Dequeues job, sets status processing
Clones repo via git2 if remote
Walks directory, computes SHA-256 fingerprints;

if (Clone Successful?) then (Yes)

  #FFF3E0:== ref: Code Parsing Loop ==
  FOR EACH changed file
  tree-sitter parses file by language
  Extracts functions, classes, modules
  Extracts calls, imports, inherits
  END LOOP;

  #FFEBEE:== ref: Graph Storage ==
  Worker creates FileNode, FunctionNode
  and ClassNode in Neo4j
  Creates CALLS, IMPORTS, INHERITS edges
  Updates file_fingerprints in PostgreSQL
  Caches results in Redis TTL 1hr
  Sets job status completed;

else (No)

  #FFEBEE:== ref: Error Handling ==
  Sets job status failed
  Logs error in validation_errors
  Extension polls and shows error;
  stop

endif

#F3E5F5:== ref: Graph Query ==
Extension polls GET /api/v1/jobs/id
Receives status completed
Requests GET /api/v1/graph/repo
Graph Engine queries Neo4j
Applies force-directed layout
Detects circular dependencies
Calculates hotspot scores
Returns JSON with nodes and edges;

#E3F2FD:== ref: Rendering Sequence ==
Extension sends graph data to WebView
ReactFlow renders interactive graph
Color coding hotspots red, violations yellow
Developer can zoom, pan, search, filter;

if (Developer Interacts?) then (Click Node)

  #E3F2FD:== ref: Node Click ==
  WebView posts openFile with path
  Extension opens source file in editor;

else (Export)

  #E3F2FD:== ref: Export ==
  WebView captures canvas as PNG
  Developer downloads image;

endif

if (File Changed on Save?) then (Yes)

  :== ref: Incremental Update ==
  FileWatcher detects save event
  Re-parse changed file locally
  Send incremental update to API
  Worker processes only changed files
  Neo4j nodes and edges updated
  Graph auto-refreshes in WebView;

else (No)
endif

:Developer continues browsing
architecture graph;

stop

legend right
  |= Color |= Component |
  | <#E8EAF6> | Extension / General |
  | <#E8F5E9> | API Gateway |
  | <#FFF3E0> | Ingestion Worker |
  | <#F3E5F5> | Graph Engine |
  | <#FFEBEE> | Database / Errors |
  | <#E3F2FD> | WebView / UI |
endlegend

footer ArchMind - UH4 | Interaction Overview Diagram

@enduml
